let pages = [];
let totalPages = 229;
let currentPage = 0;
let dragging = false;
let dragStartX = 0;
let pageTurnProgress = 0;

function preload() {
  for (let i = 1; i <= totalPages; i++) {
    let num = nf(i, 3);
    pages.push(loadImage("pages/image_" + num + ".jpg"));
  }
}

function setup() {
  createCanvas(windowWidth, windowHeight);
}

function draw() {
  background(255);

  if (currentPage >= 0 && currentPage < totalPages) {
    image(pages[currentPage], 0, 0, width, height);
  }

  if (pageTurnProgress > 0) {
    push();
    translate(width, 0);
    scale(-pageTurnProgress, 1);
    if (currentPage + 1 < totalPages) {
      image(pages[currentPage + 1], 0, 0, width, height);
    }
    pop();
    pageTurnProgress *= 0.9;
  }

  drawProgressBar();
}

function mousePressed() {
  dragging = true;
  dragStartX = mouseX;
}

function mouseReleased() {
  dragging = false;
  let dx = mouseX - dragStartX;

  if (dx < -50 && currentPage < totalPages - 1) {
    currentPage++;
    pageTurnProgress = 1;
  } else if (dx > 50 && currentPage > 0) {
    currentPage--;
    pageTurnProgress = 1;
  }
}

function drawProgressBar() {
  let barW = width * 0.7;
  let barX = (width - barW) / 2;
  let barY = height - 30;

  stroke(0);
  line(barX, barY, barX + barW, barY);

  let pos = map(currentPage, 0, totalPages - 1, barX, barX + barW);
  ellipse(pos, barY, 15, 15);
}

function mouseDragged() {
  let barW = width * 0.7;
  let barX = (width - barW) / 2;
  let barY = height - 30;

  if (dist(mouseX, mouseY, barX, barY) < 20) {
    let newPage = int(map(mouseX, barX, barX + barW, 0, totalPages - 1));
    newPage = constrain(newPage, 0, totalPages - 1);
    currentPage = newPage;
  }
}
